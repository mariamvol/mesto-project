(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var o=e.g.document;if(!t&&o&&(o.currentScript&&"SCRIPT"===o.currentScript.tagName.toUpperCase()&&(t=o.currentScript.src),!t)){var r=o.getElementsByTagName("script");if(r.length)for(var n=r.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=r[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const t="a3b44433-a869-415b-a64a-1f55665f2fda",o="https://mesto.nomoreparties.co/v1/apf-cohort-202",r={baseUrl:o,headers:{authorization:t,"Content-Type":"application/json"}};function n(e){return fetch(`${o}/cards/likes/${e}`,{method:"PUT",headers:{authorization:t}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))}function c(e){return fetch(`${o}/cards/likes/${e}`,{method:"DELETE",headers:{authorization:t}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))}function a(e,t,o="Сохранить"){t.textContent=e?"Сохранение...":o}function i(e,r,a){const i=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),u=i.querySelector(".card__image"),s=i.querySelector(".card__title"),l=i.querySelector(".card__delete-button"),p=i.querySelector(".card__like-button"),d=i.querySelector(".card__like-count");return s.textContent=e.name,u.src=e.link,u.alt=e.name,d.textContent=e.likes.length,e.likes.some((e=>e._id===a))&&p.classList.add("card__like-button_is-active"),e.owner._id!==a?l.remove():l.addEventListener("click",(()=>{var r;(r=e._id,fetch(`${o}/cards/${r}`,{method:"DELETE",headers:{authorization:t}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))).then((()=>{i.remove()})).catch((e=>console.error("Ошибка при удалении карточки:",e)))})),p.addEventListener("click",(()=>{(p.classList.contains("card__like-button_is-active")?c:n)(e._id).then((e=>{d.textContent=e.likes.length,p.classList.toggle("card__like-button_is-active")})).catch((e=>console.error("Ошибка при лайке:",e)))})),u.addEventListener("click",(()=>{r(e.name,e.link)})),i}function u(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",l)}function s(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",l)}function l(e){if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");e&&s(e)}}function p(e,t){const o=e.some((e=>!e.validity.valid));t.disabled=o}function d(e){const t=Array.from(e.querySelectorAll(".popup__input")),o=e.querySelector(".popup__button");t.forEach((t=>{t.dataset.touched="false",t.setCustomValidity(""),t.classList.remove("popup__input_type_error");const o=e.querySelector(`.${t.name}-input-error`);o&&(o.textContent="")})),p(t,o)}const m=e.p+"images/logo.svg",_=document.querySelector(".profile__image"),h=document.querySelector(".profile__title"),y=document.querySelector(".profile__description");let f=null;fetch(`${r.baseUrl}/users/me`,{headers:r.headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).then((e=>{h.textContent=e.name,y.textContent=e.about,_.style.backgroundImage=`url(${e.avatar})`,f=e._id})).catch((e=>{console.error("Ошибка загрузки данных пользователя:",e)})),document.querySelector(".header__logo").src=m;const v=document.querySelector(".popup_type_edit"),S=(document.querySelector(".popup_type_new-card"),document.querySelector(".popup_type_image")),q=S.querySelector(".popup__image"),g=S.querySelector(".popup__caption"),k=document.querySelector(".profile__edit-button"),b=v.querySelector(".popup__close");k.addEventListener("click",(function(){E.value=h.textContent,$.value=y.textContent,d(v.querySelector(".popup__form")),u(v)})),b.addEventListener("click",(()=>s(v)));const E=v.querySelector('[name="name"]'),$=v.querySelector('[name="description"]');v.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();const t=e.submitter;a(!0,t),updateProfile(E.value,$.value).then((e=>{h.textContent=e.name,y.textContent=e.about,s(v)})).catch((e=>{console.error("Ошибка при обновлении профиля:",e)})).finally((()=>{a(!1,t)}))}));const L=document.querySelector(".places__list"),C=document.querySelector(".profile__add-button"),j=document.querySelector(".popup_type_new-card"),w=j.querySelector(".popup__form"),x=w.querySelector('[name="place-name"]'),P=w.querySelector('[name="link"]'),T=j.querySelector(".popup__close");function A(e,t){q.src=t,q.alt=e,g.textContent=e,u(S)}C.addEventListener("click",(()=>{x.value="",P.value="",d(w),u(j)})),T.addEventListener("click",(()=>s(j))),w.addEventListener("submit",(function(e){e.preventDefault();const r=e.submitter;var n,c;a(!0,r),(n=x.value,c=P.value,fetch(`${o}/cards`,{method:"POST",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({name:n,link:c})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))).then((e=>{const t=i(e,A,f);L.prepend(t),s(j),w.reset()})).catch((e=>{console.error("Ошибка при добавлении карточки:",e)})).finally((()=>{a(!1,r)}))})),S.querySelector(".popup__close").addEventListener("click",(()=>s(S))),document.querySelectorAll(".popup").forEach((e=>e.classList.add("popup_is-animated"))),fetch(`${o}/cards`,{headers:{authorization:t}}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).then((e=>{e.forEach((e=>{const t=i(e,A,f);L.append(t)}))})).catch((e=>{console.error("Ошибка загрузки карточек:",e)})),document.querySelectorAll(".popup").forEach((e=>{e.addEventListener("mousedown",(t=>{t.target===e&&s(e)}))})),Array.from(document.querySelectorAll(".popup__form")).forEach((e=>{!function(e){const t=Array.from(e.querySelectorAll(".popup__input")),o=e.querySelector(".popup__button");p(t,o),t.forEach((r=>{r.addEventListener("input",(()=>{r.dataset.touched="true",function(e,t){let o="";const r=t.value.trim();t.validity.valueMissing?o="Вы пропустили это поле.":"url"===t.type&&t.validity.typeMismatch?o="Введите адрес сайта.":"name"===t.name&&r.length<2?o=`Минимальное количество символов: 2. Длина текста сейчас: ${r.length} символ${1===r.length?"":"а"}.`:"name"===t.name&&r.length>40?o="Максимальная длина — 40 символов.":"description"===t.name&&r.length<2?o=`Минимальное количество символов: 2. Длина текста сейчас: ${r.length} символ${1===r.length?"":"а"}.`:"description"===t.name&&r.length>200?o="Максимальная длина — 200 символов.":"place-name"===t.name&&r.length<2?o=`Минимальное количество символов: 2. Длина текста сейчас: ${r.length} символ${1===r.length?"":"а"}.`:"place-name"===t.name&&r.length>30&&(o="Максимальная длина — 30 символов."),t.setCustomValidity(o),t.validity.valid?function(e,t){const o=e.querySelector(`.${t.name}-input-error`);t.classList.remove("popup__input_type_error"),o.textContent=""}(e,t):function(e,t,o){const r=e.querySelector(`.${t.name}-input-error`);t.classList.add("popup__input_type_error"),r.textContent=o}(e,t,t.validationMessage)}(e,r),p(t,o)}))}))}(e)}));const z=document.querySelector(".popup_type_avatar"),D=z.querySelector(".popup__form"),N=D.querySelector('[name="avatar"]'),U=document.querySelector(".profile__image-edit-button"),I=z.querySelector(".popup__close");U.addEventListener("click",(()=>{N.value="",d(D),u(z)})),I.addEventListener("click",(()=>s(z))),D.addEventListener("submit",(function(e){e.preventDefault();const r=e.submitter;var n;a(!0,r),(n=N.value,fetch(`${o}/users/me/avatar`,{method:"PATCH",headers:{authorization:t,"Content-Type":"application/json"},body:JSON.stringify({avatar:n})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)))).then((e=>{_.style.backgroundImage=`url(${e.avatar})`,s(z),D.reset()})).catch((e=>{console.error("Ошибка при обновлении аватара:",e)})).finally((()=>{a(!1,r)}))}))})();